(function(){define(["jquery-private","knockout","gcviz-i18n","gcviz-func","gcviz-gisgeo","gcviz-gisnav","dijit/registry"],function(c,j,k,g,h,e,b){var d,f,i,a;d=function(o,m,n){var l=function(t,x){var y=this,A=n.overview,w=n.scalebar,s=n.scaledisplay,r,u=c("#inGeoLocation"+x),q=c("#btnClickMap"+x),z=c("#"+x+"_holder_layers"),p=g.getElemValueVM(x,["map","map"],"js"),v=[{minx:0,miny:0,maxx:0,maxy:0,title:"ddd"}];y.cancel=k.getDict("%cancel");y.close=k.getDict("%close");y.cursorTarget=k.getDict("%cursor-target");y.geoLocLabel=k.getDict("%toolbarnav-geoloclabel");y.geoLocUrl=k.getDict("%gisurllocate");y.info=k.getDict("%toolbarnav-info");y.infoAltitude=k.getDict("%toolbarnav-infoaltitude");y.infoAltitudeUrl=k.getDict("%toolbarnav-infoaltitudeurl");y.infoClickMap=k.getDict("%toolbarnav-infoclickmap");y.infoDecDeg=k.getDict("%toolbarnav-infodecdeg");y.infoDMS=k.getDict("%toolbarnav-infodms");y.infoGetInfo=k.getDict("%toolbarnav-infogetinfo");y.infoGetLocInfo=k.getDict("%toolbarnav-infogetlocinfo");y.infoLat=k.getDict("%toolbarnav-infolat");y.infoLong=k.getDict("%toolbarnav-infolong");y.infoNTS=k.getDict("%toolbarnav-infonts");y.infoOption1=k.getDict("%toolbarnav-infooption1");y.infoOption2=k.getDict("%toolbarnav-infooption2");y.infoTopoCoord=k.getDict("%toolbarnav-infotopocoord");y.infoUTM=k.getDict("%toolbarnav-infoutm");y.infoUTMeast=k.getDict("%toolbarnav-infoutmeast");y.infoUTMnorth=k.getDict("%toolbarnav-infoutmnorth");y.infoUTMz=k.getDict("%toolbarnav-infoutmz");y.insKeyboard=k.getDict("%toolbarnav-inskeyboard");y.tpGetLocInfo=k.getDict("%toolbarnav-info");y.tpMagnify=k.getDict("%toolbarnav-magnify");y.tpOverview=k.getDict("%toolbarnav-ovdrag");y.tpZoomFull=k.getDict("%toolbarnav-zoomfull");y.lblWest=k.getDict("%west");y.ScaleLabel=k.getDict("%toolbarnav-scale");y.lblLocTitle=k.getDict("%toolbarnav-info");y.mapid=x;y.WCAGTitle=k.getDict("%wcag-title");y.lblWCAGx=k.getDict("%wcag-xlong");y.lblWCAGy=k.getDict("%wcag-ylat");y.lblWCAGmsgx=k.getDict("%wcag-msgx");y.lblWCAGmsgy=k.getDict("%wcag-msgy");y.xValue=j.observable().extend({numeric:{precision:3,validation:{min:50,max:130}}});y.yValue=j.observable().extend({numeric:{precision:3,validation:{min:40,max:80}}});y.isWCAG=j.observable(false);y.isDialogWCAG=j.observable(false);y.wcagok=false;y.defaultAutoComplText=k.getDict("%toolbarnav-geolocsample");y.geoLocSample=k.getDict("%toolbarnav-geolocsample");y.infoLatDD=j.observable();y.infoLatDMS=j.observable();y.infoLongDD=j.observable();y.infoLongDMS=j.observable();y.isToolsOpen=j.observable(false);y.spnAltitude=j.observable();y.spnNTS=j.observable();y.spnUTMzone=j.observable();y.spnUTMeast=j.observable();y.spnUTMnorth=j.observable();y.lblScale=j.observable(k.getDict("%toolbarnav-scale"));y.isLocDialogOpen=j.observable(false);y.urlNTS=k.getDict("%gisurlnts");y.urlUTM=k.getDict("%gisurlutm");y.outSR=h.getOutSR(n.mapwkid);y.init=function(){y.theAutoCompleteArray=j.observableArray(v);if(A.enable){e.setOverview(p,A)}if(w.enable){e.setScaleBar(p,w)}if(s.enable){p.on("extent-change",function(){var B=Math.round(p.getScale()).toString();y.lblScale(y.ScaleLabel+B)})}setTimeout(function(){if(!n.expand){b.byId("tbnav"+x).toggle()}b.byId("tbTools"+x).toggle()},250);return{controlsDescendantBindings:true}};u.focus(function(){if(u.val()===y.geoLocSample){u.val("")}});u.autocomplete({source:function(C,B){c.ajax({url:y.geoLocUrl,dataType:"json",data:{q:C.term+"*"},success:function(D){B(c.map(D,function(Q){var K,N,M,O,H,P,J,E,L,I=Q.type,G=Q.qualifier,F=0.01799856;if(I==="ca.gc.nrcan.geoloc.data.model.PostalCode"||I==="ca.gc.nrcan.geoloc.data.model.Intersection"||G==="INTERPOLATED_POSITION"){K=Q.geometry.coordinates;N=K[1];M=K[0];O=N-F;H=N+F;P=M-F;J=M+F}else{if(G==="LOCATION"){K=Q.bbox;O=K[1];H=K[3];P=K[0];J=K[2]}else{if(G==="INTERPOLATED_CENTROID"){}}}E=Q.title;L=Q.title;v.push({minx:P,miny:O,maxx:J,maxy:H,title:Q.title});return{label:E,value:L}}))}})},minLength:3,select:function(D,E){for(var B=0;B<v.length;B++){var C=v[B];if(E.item.label===C.title){h.zoomLocation(C.minx,C.miny,C.maxx,C.maxy,p,y.outSR)}}v=[{minx:0,miny:0,maxx:0,maxy:0,title:"ddd"}];u.focus()},open:function(){c(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){c(this).removeClass("ui-corner-top").addClass("ui-corner-all")}});y.extentClick=function(){e.zoomFullExtent(p)};y.getMapClick=function(){g.getElemValueVM(p.vIdName,["header","toolsClick"],"js")();if(!y.isWCAG()){z.css("cursor","");z.addClass("gcviz-nav-cursor-pos");r=p.on("click",function(B){h.projectPoints([B.mapPoint],4326,y.displayInfo)})}else{y.isDialogWCAG(true)}};y.dialogWCAGOk=function(){var B=y.xValue()*-1,C=y.yValue();h.projectCoords([[B,C]],4326,y.displayInfo);y.isDialogWCAG(false);y.wcagok=true};y.dialogWCAGCancel=function(){y.isDialogWCAG(false)};y.dialogWCAGClose=function(){y.isDialogWCAG(false);if(!y.wcagok){y.dialogLocOk()}y.wcagok=false};y.displayInfo=function(C){var D,G,H="",F=C[0].y,E=C[0].x,B=y.infoAltitudeUrl+"lat="+F+"&lon="+E;z.removeClass("gcviz-nav-cursor-pos");if(!y.isWCAG()){r.remove()}y.infoLatDD(" "+F);y.infoLongDD(" "+E);D=f(F,E,y.lblWest);y.infoLatDMS(" "+D.latitude.format);y.infoLongDMS(" "+D.longitude.format);e.getNTS(F,E,y.urlNTS).done(function(I){y.spnNTS(I.nts)});e.getUTMzone(F,E,y.urlUTM).done(function(I){H=I.zone;y.spnUTMzone(H);h.getUTMEastNorth(F,E,H,y.spnUTMeast,y.spnUTMnorth)});c.getJSON(B,function(I){G="0";if(I.altitude!==null){G=I.altitude}y.spnAltitude(G+" m")});y.isLocDialogOpen(true)};y.dialogLocOk=function(){y.isLocDialogOpen(false);g.getElemValueVM(p.vIdName,["header","toolsClick"],"js")();setTimeout(function(){q.focus()},100)};y.init()};a=new l(o,m);j.applyBindings(a,o[0]);return a};f=function(p,o,n){var m={},l,r=parseFloat(p),q=parseFloat(o);if(r<0){l="S";r=r*-1}else{l="N"}m.latitude=i(r,l);if(q<0){l=n;q=q*-1}else{l="E"}m.longitude=i(q,l);return m};i=function(r,q){var p=parseInt(r,10),n=(r-p)*60,m=parseInt(n,10),o=Math.round(((n-m)*60)*1000)/1000,l={d:p,m:m,s:o,format:p+"Â° "+m+"' "+o+'" '+q};return l};return{initialize:d}})}).call(this);