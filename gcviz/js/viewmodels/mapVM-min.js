(function(){define(["jquery-private","knockout","gcviz-func","gcviz-gismap","gcviz-gisgeo"],function(c,d,g,f,b){var a,e;a=function(h){var i=function(n){var j=this,k=n.mapframe,l=k.id,m=k.map,o;j.init=function(){var s,q,r=m.layers,p=m.bases,v=r.length,w=p.length,u=c("#"+l+"_holder"),t,x;f.setProxy(m.urlproxy);b.setGeomServ(m.urlgeomserv);j.mapholder=u;o=f.createMap(l+"_holder",m);p=p.reverse();while(w--){q=p[w];f.addLayer(o,q)}r=r.reverse();while(v--){s=r[v];f.addLayer(o,s)}t=c("#"+l+"_holder_root");x=c("#"+l+"_holder_container");u.addClass("gcviz-map");t.addClass("gcviz-root");x.addClass("gcviz-container");j.focus(u);j.map=o;return{controlsDescendantBindings:true}};j.enterMouse=function(){j.mapholder.focus()};j.leaveMouse=function(){j.mapholder.blur()};j.focus=function(){j.mapfocus=d.observable();j.mapfocus.focused=d.observable();j.mapfocus.focused.subscribe(function(p){if(p){j.mapholder.focus();j.mapfocus(true)}else{j.mapholder.blur();j.mapfocus(false)}})};j.applyKey=function(r,q){var s=j.map,p=false;if(j.mapfocus){if(r===37){f.panLeft(s);p=true}else{if(r===38){f.panUp(s);p=true}else{if(r===39){f.panRight(s);p=true}else{if(r===40){f.panDown(s);p=true}else{if((r===187&&q)||(r===61&&q)){f.zoomIn(s);p=true}else{if((r===189&&q)||(r===173&&q)){f.zoomOut(s);p=true}else{if(r===61){p=true}else{if(r===27){if(g.getElemValueVM(l,["draw","activeTool"],"js")!==""){g.getElemValueVM(l,["draw","endDraw"],"js")();if(!g.getElemValueVM(l,["draw","isText"],"ko")){g.getElemValueVM(l,["header","toolsClick"],"js")()}}}}}}}}}}}return p};j.init()};e=new i(h);d.applyBindings(e,h[0]);return e};return{initialize:a}})}).call(this);