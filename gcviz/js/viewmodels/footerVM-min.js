(function(){define(["knockout","gcviz-i18n","gcviz-func","gcviz-gisgeo"],function(c,e,f,b){var a,d;a=function(j,g,h){var i=function(p,n,o){var l=this,k=locationPath+"gcviz/images/GCVizLogo.png",q=o.mousecoords,m=o.northarrow.inwkid,r=q.outwkid;l.imgLogoPNG=k;l.urlLogo=e.getDict("%footer-urlgcvizrepo");l.urlLogoAlt=e.getDict("%footer-tpgithub");l.lblWest=e.getDict("%west");l.coords=c.observable("");l.rotateArrow=c.observable("");l.init=function(){var s=f.getElemValueVM(n,["map","map"],"js");if(o.mousecoords){s.on("mouse-move",function(t){l.showCoordinates(t)})}if(o.northarrow){b.getNorthAngle(s.extent,m,l.updateArrow);s.on("pan-end",function(t){l.showNorthArrow(t)});s.on("zoom-end",function(t){l.showNorthArrow(t)})}return{controlsDescendantBindings:true}};l.showCoordinates=function(s){b.projectPoints([s.mapPoint],r,l.updateCoordinates)};l.updateCoordinates=function(t){var v,u,s=t[0];if(r===4326){if(s.x<0){v=(-1*s.x.toFixed(3)).toString()+l.lblWest}else{v=s.x.toFixed(3).toString()+"E"}if(s.y<0){u=(-1*s.y.toFixed(3)).toString()+"S"}else{u=s.y.toFixed(3).toString()+"N"}}else{v=s.x.toFixed(0).toString();u=s.y.toFixed(0).toString()}l.coords(" Lat: "+u+" Long: "+v)};l.showNorthArrow=function(s){b.getNorthAngle(s.extent,m,l.updateArrow)};l.updateArrow=function(A){var t,v,u,z,w,C,B,s={x:-100,y:90};C=A[0];t=(C.x-s.x)*Math.PI/180;v=s.y*Math.PI/180;u=C.y*Math.PI/180;w=Math.sin(t)*Math.cos(u);z=Math.cos(v)*Math.sin(u)-Math.sin(v)*Math.cos(u)*Math.cos(t);B=Math.atan2(w,z)*180/Math.PI;B=((B+360)%360).toFixed(1)-90;l.rotateArrow("rotate("+B+"deg)")};l.goGitHub=function(t,s){if(s.keyCode===13){window.open(l.urlLogo,"_blank")}};l.init()};d=new i(j,g,h);c.applyBindings(d,j[0]);return d};return{initialize:a}})}).call(this);