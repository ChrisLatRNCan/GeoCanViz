(function(){define(["jquery-private","knockout","media","gcviz-gisprint","gcviz-i18n","gcviz-ko","gcviz-func","gcviz-gismap","dijit/registry"],function(f,k,a,g,l,i,j,h,d){var e,c,b;e=function(o,m,n){var p=function(t,B,s){var C=this,x=s.about,y=locationPath+"gcviz/print/",w=f("#section"+B),q=f("#"+B),A=f("#"+B+"_holder"),u=f("#"+B+"_holder_root"),v=t.find(".gcviz-head-help"),D=t.find(".gcviz-head-about"),z=t.find(".gcviz-head-fs"),r=j.getElemValueVM(B,["map","map"],"js");C.xheightToolsOuter=k.observable("max-height:100px!important");C.xheightToolsInner=k.observable("max-height:100px!important");C.widthheightTBholder=k.observable("max-height:390px!important;max-width:340px!important");C.tpHelp=l.getDict("%header-tphelp");C.tpWCAG=l.getDict("%header-tpwcag");C.tpTools=l.getDict("%header-tptools");C.tpPrint=l.getDict("%header-tpprint");C.tpInset=l.getDict("%header-tpinset");C.tpAbout=l.getDict("%header-tpabout");C.tpFullScreen=l.getDict("%header-tpfullscreen");C.lblHelpTitle=l.getDict("%header-help");C.helpInfo1=l.getDict("%header-helpdownload");C.helpInfo2=l.getDict("%linkopens");C.helpURL=l.getDict("%header-urlhelp");C.helpURLText=l.getDict("%header-helpmanual");C.isHelpDialogOpen=k.observable(false);C.lblAboutTitle=l.getDict("%header-tpabout");C.isAboutDialogOpen=k.observable(false);C.aboutType=x.type;if(C.aboutType===1){C.aboutInfo1=x.value}else{if(C.aboutType===2){C.aboutInfo1=l.getDict("%header-aboutread");C.aboutInfo2=l.getDict("%linkopens");C.aboutURL=x.value;C.aboutURLText=l.getDict("%header-abouttitle")}}C.printInfo={url:l.getDict("%header-printurl"),copyright:l.getDict("%header-printcopyright"),template:y};C.isFullscreen=k.observable(false);C.isInsetVisible=k.observable(true);C.insetState=true;C.fullscreenState=0;C.opencloseToolsState=0;C.isWCAG=k.observable(false);C.init=function(){C.heightSection=parseInt(w.css("height"),10);C.heightMap=parseInt(A.css("height"),10);C.widthSection=parseInt(w.css("width"),10);C.widthMap=parseInt(A.css("width"),10);C.headerHeight=parseInt(t.css("height"),10);setTimeout(function(){C.adjustContainerHeight()},500);return{controlsDescendantBindings:true}};C.fullscreenClick=function(){j.debounceClick(function(){if(C.fullscreenState){C.cancelFullScreen()}else{C.requestFullScreen()}f(".gcviz-tooltip").remove()},1000)};C.printClick=function(){c(r,C.printInfo.template)};C.insetClick=function(){j.debounceClick(function(){var E;C.insetState=!C.insetState;C.isInsetVisible(C.insetState);if(C.insetState){E=w.find("[tabindex = 0]");C.first=E[0];C.last=E[E.length-1]}else{E=w.find("[tabindex = 0]").not(".gcviz-inset-button");C.first=E[0];C.last=E[E.length-1]}},1000)};C.toolsClick=function(){var E=d.byId("tbTools"+B);E.toggle()};C.helpClick=function(){C.isHelpDialogOpen(true)};C.WCAGClick=function(){C.isWCAG(!C.isWCAG())};C.dialogHelpOk=function(){C.isHelpDialogOpen(false);v.focus()};C.aboutClick=function(){C.isAboutDialogOpen(true)};C.dialogAboutOk=function(){C.isAboutDialogOpen(false);D.focus()};C.cancelFullScreen=function(){j.setStyle(w[0],{width:C.widthSection+"px",height:C.heightSection+"px"});j.setStyle(q[0],{width:C.widthSection+"px",height:C.heightSection+"px"});j.setStyle(A[0],{width:C.widthMap+"px",height:C.heightMap+"px"});j.setStyle(u[0],{width:C.widthMap+"px",height:C.heightMap+"px"});w.removeClass("gcviz-sectionfs");C.isFullscreen(false);C.fullscreenState=0;h.manageScreenState(r,500,false);setTimeout(function(){C.adjustContainerHeight()},500);z.focus();w.off("keydown.fs")};C.requestFullScreen=function(){var G=j.getFullscreenParam(C.widthSection,C.heightSection),E=G.width,F=G.height,H=w.find("[tabindex = 0]");j.setStyle(w[0],{width:screen.width+"px",height:screen.height+"px"});j.setStyle(q[0],{width:E+"px",height:F+"px"});j.setStyle(A[0],{width:E+"px",height:(F-(2*C.headerHeight))+"px"});j.setStyle(u[0],{width:E+"px",height:(F-(2*C.headerHeight))+"px"});w.addClass("gcviz-sectionfs");C.isFullscreen(true);C.fullscreenState=1;h.manageScreenState(r,1000,true);setTimeout(function(){C.adjustContainerHeight();t.find(".gcviz-head-reg").focus()},500);C.first=H[0];C.last=H[H.length-1];w.on("keydown.fs",function(I){C.manageTabbingOrder(I)})};C.adjustContainerHeight=function(){var E=parseInt(r.height,10)-15;C.xheightToolsOuter("max-height:"+E+"px!important");C.xheightToolsInner("max-height:"+E+"px!important");E-=25;C.widthheightTBholder("max-height:"+E+"px!important;max-width:340px!important")};C.manageTabbingOrder=function(F){var H=F.which,E=F.shiftKey,K=F.target.className,I=C.first.className,G=C.last.className,L=C.first,J=C.last;if(H===9&&!E){if(K===G){setTimeout(function(){L.focus()},0)}}else{if(H===9&&E){if(K===I){setTimeout(function(){J.focus()},0)}}}};C.init()};b=new p(o,m,n);k.applyBindings(b,o[0]);return b};c=function(o,m){var n=f("#"+o.vIdName+"_holder").clone();localStorage.setItem("gcvizPrintNode",n[0].outerHTML);window.open(m+"defaultPrint.html")};return{initialize:e}})}).call(this);