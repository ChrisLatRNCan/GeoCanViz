(function(){define(["jquery-private","cluster","gcviz-gisgeo","esri/request","esri/symbols/SimpleMarkerSymbol","esri/renderers/ClassBreaksRenderer","esri/renderers/jsonUtils","esri/geometry/Point","esri/SpatialReference"],function(g,l,m,e,c,b,a,i,k){var h,d,j,f={};d=function(q,p){var o=p.url,n=o.substring(0,o.indexOf("MapServer/"))+"MapServer/layers";e({url:n,content:{f:"json"},handleAs:"json",callbackParamName:"callback",load:function(r){h(q,p,r.layers[0].drawingInfo.renderer)},error:function(r){console.log("renderer info error: "+r)}})};h=function(q,p,o){var n;n=p.url+"0/query?where=OBJECTID+>+0&outFields=AGE&dirty="+(new Date()).getTime();e({url:n,content:{f:"json"},handleAs:"json",callbackParamName:"callback",load:function(t){var v,y,z,x=[],w=q.spatialReference.wkid,s=t.spatialReference.wkid,r=t.features,u=r.length;while(u--){v=r[u];y=v.geometry;z=new i(y.x,y.y,new k({wkid:s}));z.attributes=v.attributes,x.push(z)}f={map:q,renderJSON:o,layerInfo:p};if(w!==s){m.projectPoints(x,w,j)}else{j(x)}},error:function(r){console.log("cluster info error: "+r)}})};j=function(q){var n,s=f.map,r=f.layerInfo,o=r.cluster,p=a.fromJson(f.renderJSON);if(o.symbol===1){p=null}n=new l({data:q,renderer:p,distance:o.distance,id:r.id,label:o.label,maxSizeProp:o.maxSizeProp,maxDataProp:o.maxDataProp,spatialReference:s.spatialReference});s.addLayer(n);f={};s.reorderLayer(s.getLayer("gcviz-symbol"),1000)};return{startCluster:d}})}());