(function(){define(["kineticpanning","gcviz-func","dijit/Menu","dijit/MenuItem","dijit/PopupMenuItem","gcviz-gislegend","gcviz-giscluster","esri/config","esri/map","esri/layers/FeatureLayer","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISImageServiceLayer","esri/layers/WebTiledLayer","esri/layers/WMSLayer","esri/layers/WMSLayerInfo","esri/geometry/Extent","esri/geometry/Point","esri/IdentityManager"],function(e,s,S,U,D,F,E,o,L,H,d,k,q,J,y,P,f,R){var z={},K,r,G,a,b,T,j,n,i,O,C,Q,M,B,t,h,A,p,m,v,c,x=[],N,w,I={},g,l,u=false;K=function(V){o.defaults.io.proxyUrl=V;o.defaults.io.alwaysUseProxy=false};r=function(X,Y){var W=Y.extentinit,ac=Y.extentmax,aa=Y.sr.wkid,ae=new f({xmin:W.xmin,ymin:W.ymin,xmax:W.xmax,ymax:W.ymax,spatialReference:{wkid:aa}}),af=new f({xmin:ac.xmin,ymin:ac.ymin,xmax:ac.xmax,ymax:ac.ymax,spatialReference:{wkid:aa}}),ab=Y.lods,ag,V,ad=X.split("_")[0],Z;if(ab.length){ag={extent:ae,spatialReference:{wkid:aa},logo:false,showAttribution:false,lods:ab,wrapAround180:true,smartNavigation:false}}else{ag={extent:ae,spatialReference:{wkid:aa},logo:false,showAttribution:false,wrapAround180:true,smartNavigation:false}}V=new L(X,ag);z[ad]=V;Z=new e(V);Z.enableMouse();V.vInitExtent=ae;V.vFullExtent=af;V.vIdName=ad;V.vWkid=aa;V.vInsetId=[];V.on("load",function(){V.resize();V.enableScrollWheelZoom();V.isZoomSlider=false;V.disableDoubleClickZoom();if(Y.link){x.push({name:V.vIdName,fire:false});T(V)}else{j(V)}l=x.length});return V};G=function(ac,V,W){var ab=V.extent,Z=V.sr.wkid,Y=new f({xmin:ab.xmin,ymin:ab.ymin,xmax:ab.xmax,ymax:ab.ymax,spatialReference:{wkid:Z}}),aa,X;aa=new L(ac,{extent:Y,spatialReference:{wkid:Z},logo:false,showAttribution:false,smartNavigation:false});X=new e(aa);X.enableMouse();aa.vWkid=Z;aa.vType=V.type;aa.on("load",function(){aa.resize();aa.disableMapNavigation();if(V.type!=="static"){z[W].vInsetId.push(aa.id);I[ac]=aa;if(V.typeinfo.pan){aa.enablePan()}if(V.type==="panscale"){aa.vLod=V.typeinfo.lod;aa.setLevel(aa.vLod);setTimeout(function(){aa.vDeltaX=(Math.abs(aa.extent.xmax)-Math.abs(aa.extent.xmin))/2;aa.vDeltaY=(Math.abs(aa.extent.ymax)-Math.abs(aa.extent.ymin))/2},1000)}}});return aa};a=function(Y){var V=x.length,X,Z,W;while(V--){Z=x[V];X=Z.name;if(X!==Y){W=z[X];W.setExtent(z[Y].extent,W.spatialReference)}}};w=function(X){var V=X.vInsetId.length,W;while(V--){W=I[X.vInsetId[V]];if(W.vType==="panscale"){b(X,W)}else{if(W.vType==="link"){W.setExtent(X.extent)}}}};b=function(Y,V){var X=Q(Y),W=new f({xmin:X.x-V.vDeltaX,ymin:X.y-V.vDeltaY,xmax:X.x+V.vDeltaX,ymax:X.y+V.vDeltaY,spatialReference:{wkid:Y.spatialReference.wkid}});V.setExtent(W)};T=function(V){V.on("extent-change",s.debounce(function(X){var Y=X.target,Z=Y.id.split("_")[0],W=false;if(l===x.length){W=true}if(W&&!g){setTimeout(function(){a(Z)},1000)}if(!u){w(Y)}u=false;l-=1;if(l===0){setTimeout(function(){l=x.length},1000)}},1000,false))};j=function(V){V.on("extent-change",s.debounce(function(W){var X=W.target;if(!u){w(X)}u=false},1000,false))};n=function(Z,Y){var W,V,aa,X=Y.type;if(X===1){}else{if(X===2){W=new d(Y.url,{id:Y.id})}else{if(X===3){V=Y.options;aa={extent:Z.extent,layerInfos:V.layerinfos};W=new y(Y.url,{resourceInfo:aa,visibleLayers:V.visiblelayers,id:Y.id})}else{if(X===4){W=new k(Y.url,{id:Y.id})}else{if(X===5){W=new H(Y.url,{mode:H.MODE_ONDEMAND,outFields:["*"],id:Y.id})}else{if(X===6){E.startCluster(Z,Y)}}}}}}if(X!==6){Z.addLayer(W)}};c=function(X,V){var W;if(X===1){W=new J(V)}else{if(X===2){W=new d(V)}else{if(X===4){W=new k(V)}}}return W};i=function(V){V.resize()};O=function(Y,X){var V,W;X=X||{};V=X.point||Q(Y);W=X.interval||0;i(Y);setTimeout(function(){C(Y,V)},W)};C=function(W,V){V=V||Q(W);W.centerAt(V)};Q=function(X){var W,V;W=X.extent;V=new R((W.xmin+W.xmax)/2,(W.ymin+W.ymax)/2,X.vWkid);return V};N=function(Y,V,X){var W=Y.extent;g=X;if(X){u=true}i(Y);setTimeout(function(){Y.setExtent(W)},V)};M=function(){var V=new S({targetNodeIds:["gcviz-header"]});V.addChild(new U({label:"Add Point",onClick:function(){}}));V.startup()};B=function(V){V.setExtent(v(V,"in"))};t=function(V){V.setExtent(v(V,"out"))};h=function(V){V.setExtent(v(V,"left"))};A=function(V){V.setExtent(v(V,"up"))};p=function(V){V.setExtent(v(V,"right"))};m=function(V){V.setExtent(v(V,"down"))};v=function(V,ab){var ae=V.extent,aa=2,Y=4,ad,W=ae.xmin,Z=ae.xmax,ac=ae.ymin,X=ae.ymax;if(ab==="up"){ad=(X-ac)/aa;ac=ac-ad;X=X-ad}else{if(ab==="down"){ad=(X-ac)/aa;ac=ac+ad;X=X+ad}else{if(ab==="left"){ad=(Z-W)/aa;W=W-ad;Z=Z-ad}else{if(ab==="right"){ad=(Z-W)/aa;W=W+ad;Z=Z+ad}else{if(ab==="in"){ad=(Z-W)/Y;W=W+ad;Z=Z-ad;ad=(X-ac)/Y;ac=ac+ad;X=X-ad}else{if(ab==="out"){ad=(Z-W)/Y;W=W-ad;Z=Z+ad;ad=(X-ac)/Y;ac=ac-ad;X=X+ad}}}}}}ae=new f({xmin:W,ymin:ac,xmax:Z,ymax:X,spatialReference:{wkid:V.spatialReference.wkid}});return ae};return{setProxy:K,createMap:r,createInset:G,addLayer:n,resizeMap:i,resizeCenterMap:O,zoomPoint:C,getOverviewLayer:c,getMapCenter:Q,manageScreenState:N,createMapMenu:M,zoomIn:B,zoomOut:t,panLeft:h,panUp:A,panRight:p,panDown:m}})}());